# COMMAND.COM を動かすためのメモリイメージ

- 8086 CPUで、COMMAND.COMを動かしたい。
- マシンについて。
  - CPUは8086
  - モニタがメモリにイメージを書き込み後、CPUをリセットして起動する。
  - RAMが128KBあり、00000〜1FFFF番地にメインでマップされ、それ以降のアドレスにも繰り返し反映される。
  - 20000-3FFFF番地に同じRAM内容が見える。
  - E0000-FFFFF番地も同じ内容が見えるため、1FFF0にリセットハンドラを置けば、FFFF0に存在するように見える。
- 目標について。
  - COMMAND.COMを起動し、内部コマンド(VERなど)を実行できる。
  - モニタプログラムはIO命令で次の機能を提供する。
    - アスキーコードで1文字単位の入出力を提供する。
    - ログ記録
  - 割り込みハンドラを全て用意し、COMMAND.COMが要求した全ての割り込みをハンドルする。
    - 文字入出力はIO命令を使い実装する。
    - その他の内部コマンドに必要な機能を実装する。
    - TODO: 実装が必要なハンドラを列挙する。
    - これらのハンドラは、呼び出された事やパラメータをログに記録する。
    - 必要と思われないものでも、ハンドラは用意し、呼び出しがあった事を、ログに記録する。
- メモリマップ
  - 00000-00400 割り込みベクタ
  - 01000-10FFF COMMAND.COM用のセグメント(64KB)
  - 01000-010FF     PSP領域
  - 01100-10FFF     COMMAND.COMの内容のコピー
  - 11000-1DFFF 割り込みハンドラ0から256
  - 1E000-1FFEF リセットハンドラ
  - 1FFF0-1FFFF リセットベクタ
- 実装戦略
  - 生成物はサイズ128KBのbinファイル
  - nasmを使って生成する。
  - ログを読める状態にするためのPythonスクリプトを作る。
  - ビルド方法の説明のために、Makefileを作る。
