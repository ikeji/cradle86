## V30 Monitor のメモリ使用量に関する考察

### 1. グローバル変数のメモリ使用量

`main.cpp`における主要なメモリ消費源は以下のグローバル変数です。

-   `uint8_t ram[RAM_SIZE];`
-   `BusLog trace_log[MAX_CYCLES];`

`BusLog`構造体のサイズは8バイトです。

**現在の設定（RAM_SIZE = 64KB, MAX_CYCLES = 5000）での見積もり:**
-   `ram`: 64 KB
-   `trace_log`: 5000 * 8バイト = 40 KB
-   **グローバル変数合計: 104 KB**

**RAM_SIZEを128KBに変更した場合の見積もり:**
-   `ram`: 128 KB
-   `trace_log`: 40 KB (変更なし)
-   **グローバル変数合計: 168 KB**

### 2. スタックメモリの使用量

関数呼び出し時にスタック上に一時的に確保されるローカル変数についても検討しました。

`main.cpp`内で確認された主なローカル変数は以下の通りです。
-   `char line[128]`
-   `char cmd_line_copy[256]`
-   `char asm_line[128]`
-   `uint8_t buffer[133]` (XMODEM関連)
-   `char args[256]`
-   `char disasm_str[128]`

これらのローカル変数は最大でも256バイト程度であり、関数のネストも深くないため、スタック全体の消費量は数KB程度と予測されます。再帰呼び出しなど、スタックを大量に消費するような処理は見当たりません。

### 3. 総合的な結論

Picoの総RAM容量256KBに対して、RAM_SIZEを128KBに設定した場合のメモリ使用量の見積もりは以下の通りです。

-   グローバル変数: 約168KB
-   残りの利用可能RAM (スタック、ヒープなど): 256KB - 168KB = 約88KB
-   スタック使用量: 数KB程度

約88KBの空き領域に対して、スタック使用量は非常に小さいため、**RAM_SIZEを128KBにしても、全体として256KBのRAMに十分に収まり、一時バッファによるスタック枯渇の心配はまずありません。**
コード上、動的なヒープ割り当て（`malloc`等）も確認されていないため、この88KBのほとんどはスタック領域として利用可能です。